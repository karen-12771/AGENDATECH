<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    defer
  ></script>
  <title>Agendatech</title>
  <link rel="icon" href="src/img/favicon.ico" type="image/x-icon" />
  <style>
    body.modal-open { overflow: hidden; }
    .login-container {
      max-width: 400px;
      background-color: #f7f7f7;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      padding: 30px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1050;
      display: none;
    }
    .login-container.show { display: block; animation: fadeIn 0.3s ease forwards; }
    @keyframes fadeIn { from {opacity:0; transform:translate(-50%, -60%);} to {opacity:1; transform:translate(-50%, -50%);} }
    .form-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .close-btn { cursor:pointer; font-size:24px; color:#a45a19; border:none; background:none; line-height:1; }
    label { display:block; margin-top:15px; margin-bottom:5px; font-weight:600; color:#333; }
    input[type="text"], input[type="email"], input[type="password"] { width:100%; padding:10px; border:2px solid #a45a19; border-radius:8px; box-sizing:border-box; font-size:14px; }
    .password-wrapper { position:relative; }
    .toggle-password { position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer; color:#a45a19; font-size:18px; user-select:none; }
    .checkbox-wrapper { margin-top:15px; display:flex; align-items:center; gap:6px; }
    .login-btn { margin-top:20px; width:100%; background-color:#a45a19; color:white; border:none; padding:12px; border-radius:8px; font-weight:bold; font-size:16px; cursor:pointer; transition: background 0.3s ease; }
    .login-btn:hover { background-color:#8a4713; }
    .links { text-align:center; margin-top:15px; }
    .links a { color:#4a4a4a; text-decoration:none; font-size:14px; cursor:pointer; }
    .links a:hover { text-decoration:underline; }
    .overlay { position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); z-index:1040; display:none; }
    .overlay.show { display:block; animation:fadeInOverlay 0.3s ease forwards; }
    @keyframes fadeInOverlay { from{opacity:0;} to{opacity:1;} }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="site-header d-flex justify-content-between align-items-center p-3 border-bottom">
    <a href="/" class="site-logo d-flex align-items-center gap-2">
      <img src="src/img/womanLogo.png" alt="Logo mujer" style="height:40px;" />
      <img src="src/img/bellezaLogo.png" alt="Logo belleza" style="height:40px;" />
    </a>
    <nav id="menu" class="menu">
      <ul class="list-unstyled d-flex gap-3 mb-0 align-items-center">
        <li><a href="#" class="text-decoration-none">Ag√©ndate</a></li>
        <li><a href="#" class="text-decoration-none">Productos</a></li>
        <li><a href="#" class="text-decoration-none">Mi cuenta</a></li>
        <li><a href="#"><img src="src/img/shoppingCart.png" alt="Carrito" style="height:24px;" /></a></li>
        <li><button id="openLoginBtn" class="btn btn-sm btn-outline-warning">Iniciar sesi√≥n</button></li>
      </ul>
    </nav>
  </header>

  <!-- CARRUSEL -->
  <div class="custom-carousel-container my-4 container">
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner rounded">
        <div class="carousel-item active"><img src="src/img/slide1.png" class="d-block w-100" alt="Slide 1" style="max-height: 400px; object-fit: cover;"></div>
        <div class="carousel-item"><img src="src/img/slide2.png" class="d-block w-100" alt="Slide 2" style="max-height: 400px; object-fit: cover;"></div>
        <div class="carousel-item"><img src="src/img/slide3.png" class="d-block w-100" alt="Slide 3" style="max-height: 400px; object-fit: cover;"></div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span><span class="visually-hidden">Anterior</span></button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next"><span class="carousel-control-next-icon"></span><span class="visually-hidden">Siguiente</span></button>
    </div>
  </div>

  <!-- OVERLAY Y FORMULARIO -->
  <div class="overlay" id="overlay"></div>
  <div class="login-container" id="loginContainer">
    <form id="loginForm">
      <div class="form-header">
        <h3 id="formTitle">Iniciar Sesi√≥n</h3>
        <button type="button" class="close-btn">&times;</button>
      </div>
      <div id="nameFields" style="display:none;">
        <label for="firstName">Nombre</label>
        <input type="text" id="firstName" placeholder="Nombre" />
        <label for="lastName">Apellido</label>
        <input type="text" id="lastName" placeholder="Apellido" />
      </div>
      <label for="email">Correo Electr√≥nico</label>
      <input type="email" id="email" placeholder="Correo Electr√≥nico" required />
      <label for="password">Contrase√±a</label>
      <div class="password-wrapper">
        <input type="password" id="password" placeholder="Contrase√±a" required />
        <span class="toggle-password">üëÅÔ∏è</span>
      </div>
      <div class="checkbox-wrapper">
        <input type="checkbox" id="rememberMe" />
        <label for="rememberMe">Recu√©rdame</label>
      </div>
      <button type="submit" class="login-btn" id="submitBtn">Acceder</button>
      <div class="links">
        <a id="toggleRegister">Registrarme</a><br/>
        <a href="#">Olvid√© mi contrase√±a</a>
      </div>
    </form>
  </div>

  <script>
    const loginContainer = document.getElementById("loginContainer");
    const overlay = document.getElementById("overlay");
    const openLoginBtn = document.getElementById("openLoginBtn");
    const form = document.getElementById("loginForm");
    const emailInput = document.getElementById("email");
    const passInput = document.getElementById("password");
    const toggleBtn = form.querySelector(".toggle-password");
    const closeBtn = form.querySelector(".close-btn");
    const toggleRegister = document.getElementById("toggleRegister");
    const formTitle = document.getElementById("formTitle");
    const submitBtn = document.getElementById("submitBtn");
    const nameFields = document.getElementById("nameFields");
    const firstName = document.getElementById("firstName");
    const lastName = document.getElementById("lastName");

    let isRegister = false;

    // Funciones abrir/cerrar modal
    function abrirLogin() {
      loginContainer.classList.add("show");
      overlay.classList.add("show");
      document.body.classList.add("modal-open");
      form.reset();
      passInput.type = "password";
      toggleBtn.textContent = "üëÅÔ∏è";
      if(!isRegister) nameFields.style.display="none";
    }
    function cerrarLogin() {
      loginContainer.classList.remove("show");
      overlay.classList.remove("show");
      document.body.classList.remove("modal-open");
    }

    openLoginBtn.addEventListener("click", abrirLogin);
    closeBtn.addEventListener("click", cerrarLogin);
    overlay.addEventListener("click", cerrarLogin);

    // Toggle contrase√±a
    toggleBtn.addEventListener("click", () => {
      if(passInput.type==="password"){ passInput.type="text"; toggleBtn.textContent="üôà"; }
      else { passInput.type="password"; toggleBtn.textContent="üëÅÔ∏è"; }
    });

    // Cambiar entre login y registro
    toggleRegister.addEventListener("click", () => {
      isRegister = !isRegister;
      if(isRegister){
        formTitle.textContent = "Registrarse";
        submitBtn.textContent = "Registrarme";
        nameFields.style.display="block";
      } else {
        formTitle.textContent = "Iniciar Sesi√≥n";
        submitBtn.textContent = "Acceder";
        nameFields.style.display="none";
      }
      form.reset();
      passInput.type="password";
      toggleBtn.textContent="üëÅÔ∏è";
    });

    // Enviar login / registro
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = emailInput.value.trim();
      const password = passInput.value.trim();
      const name = firstName.value.trim();
      const surname = lastName.value.trim();

      if(!email || !password || (isRegister && (!name || !surname))) {
        alert("Completa todos los campos");
        return;
      }

      try {
        const res = await fetch("/api/usuarios", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({
            name: isRegister? name : "Usuario",
            surname: isRegister? surname : "Prueba",
            email,
            username: email.split("@")[0],
            password,
            role:"cliente"
          })
        });
        const data = await res.json();
        if(data.error) alert("Error: "+data.error);
        else {
          alert(isRegister? `Usuario registrado: ${data.username}` : `¬°Bienvenido ${data.username}!`);
          form.reset();
          cerrarLogin();
          listarUsuarios();
        }
      } catch(err){ console.error(err); alert("Error al conectar con el servidor"); }
    });

    // Listar usuarios
    async function listarUsuarios() {
      try {
        const res = await fetch("/api/usuarios");
        const data = await res.json();
        console.log("Usuarios registrados:", data);
      } catch(err){ console.error(err); }
    }
  </script>
</body>
</html>
